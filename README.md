This repository contains automation scripts and configurations for provisioning and configuring a secure VPN cluster with Wireguard and OpenVPN Access Server on Hetzner infrastructure. It also demonstrates MFA (Multi-Factor Authentication) setup, VPN failover, and secure SSH key deployment.

Overview
Infrastructure Provisioning (Terraform):
Automates the creation of 5 Ubuntu 24.04 servers on Hetzner with specified internal IPs (10.0.0.x) and public IPs.

Wireguard Configuration:
Ensures internal LAN connectivity among all servers. The configuration files and runtime details are included, with sensitive data redacted.

OpenVPN Access Server Setup:
Provides client VPN access, MFA (using Google Authenticator), and failover capabilities between a primary and a secondary VPN node.

Failover Configuration:
Demonstrates how the VPN connection automatically switches to the secondary server if the primary server goes down, using official OpenVPN failover methods and multi-remote directives in the client .ovpn file.

SSH Key Deployment:
A specific SSH key was manually deposited on each server to allow secure, passwordless administrative access.

Repository Structure
*.tf / Terraform Files

main.tf, variables.tf, outputs.tf, terraform.tfvars, etc.
Defines how to provision the Hetzner servers, assign IP addresses, and handle infrastructure as code.
Wireguard Configuration

wireguard_config.txt (redacted): Example Wireguard configuration for each server.
Demonstrates how each server is set up to communicate over an internal 10.0.0.x network.
OpenVPN Access Server Configuration

openvpn_as_config_server1.txt (redacted)
openvpn_as_config_server3.txt (redacted)
Contains OpenVPN Access Server configuration details, with sensitive keys and certificates removed.
State Files

terraform.tfstate, terraform.tfstate.backup
Automatically generated by Terraform (not recommended to keep in a public repo with sensitive data).
Prerequisites
Terraform (v1.0+ recommended)
Hetzner Cloud Account
SSH Keys for secure server access
OpenVPN Client (for VPN testing)
Google Authenticator or another TOTP app (for MFA testing)
Usage
Clone this Repository:
bash
Copy
git clone https://github.com/<YourUser>/my-automation-repo.git
Configure Terraform Variables:
In terraform.tfvars, add your Hetzner API token (consider storing it securely or using environment variables).
Deploy the Infrastructure:
bash
Copy
terraform init
terraform plan
terraform apply
This provisions the 5 Ubuntu servers on Hetzner.
Wireguard Configuration:
Review wireguard_config.txt (redacted) to see how each server is set up for internal connectivity.
OpenVPN Access Server Configuration:
Review openvpn_as_config_server1.txt and openvpn_as_config_server3.txt (redacted) to see how MFA, failover, and server settings are managed.
SSH Key Deployment:
The provided public key is manually placed in each server’s ~/.ssh/authorized_keys.
VPN Failover Testing:
Stop the OpenVPN Access Server service on the primary node (e.g., service openvpnas stop) and confirm that clients seamlessly connect to the secondary node.
Security and Best Practices
Redacted Keys:
Sensitive private keys, API tokens, and subscription data have been removed for security.
SSH Keys:
Ensure you store your private keys securely (e.g., not committed to version control).
Rotate Keys and Tokens:
Regularly rotate your Hetzner API tokens and SSH keys to maintain security.
Contributing
Fork this Repository
Create a Feature Branch
Commit Your Changes
Open a Pull Request
License
This project is for demonstration and testing purposes. Use at your own discretion. You can add a license if you’d like (e.g., MIT, Apache 2.0, etc.).

Contact
For any questions or clarifications, feel free to reach out via GitHub Issues or contact me directly.
